<ion-header>
  
  <ion-navbar>
    <ion-title>Share Recipe</ion-title>
    
    <ion-buttons start>
      <button ion-button (click)="cancel()">
        <span ion-text color="primary" showWhen="ios">Cancel</span>
        <ion-icon name="md-close" showWhen="android, windows, core"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>

</ion-header>


<ion-content>
  <ion-list>
      <ion-item>
        <ion-avatar *ngIf="recipe.image" item-start>
          <img src="{{ recipe.image.location }}">
        </ion-avatar>
        <h2>{{ recipe.title }}</h2>
        <p text-wrap>
          When sharing, a copy of this recipe will be sent to the recipient. Your copy will not be affected.
        </p>
      </ion-item>
      
      <ion-item>
        <ion-label floating>New recipient email...</ion-label>
        <ion-input [(ngModel)]="recipientEmail" (ngModelChange)='autofillUserName()'></ion-input>
      </ion-item>
      
      <p *ngIf="recipientEmail.length > 0 && !searchingForRecipient" padding-left padding-bottom>
        <span *ngIf="recipientName">User found: <b>{{ recipientName }}</b>. Press send to share recipe.</span>
        <span *ngIf="!recipientName">No user found with that email address.</span>
      </p>
      <p *ngIf="recipientEmail.length === 0 && !searchingForRecipient" padding-left padding-bottom>
        Enter an email address to search for a user <span *ngIf="threads.length > 0">or select a conversation below</span>
      </p>
      <p *ngIf="searchingForRecipient" padding-left padding-bottom>
        Searcing for user...
      </p>
      
      <ion-list *ngIf="threads.length > 0" radio-group [(ngModel)]="selectedThread" (ngModelChange)="selectRecipient(selectedThread)">
        <ion-list-header style="margin-bottom: 0;" no-lines>
          Existing Conversations
        </ion-list-header>
      
        <ion-item *ngFor="let thread of threads">
          <ion-label>{{ thread.otherUser.name || thread.otherUser.email }} <span *ngIf="thread.otherUser.name">({{ thread.otherUser.email }})</span></ion-label>
          <ion-radio [value]="thread"></ion-radio>
        </ion-item>
      </ion-list>
      
      <!--<div *ngFor="let thread of threads">-->
        
      <!--</div>-->

      <!--<ion-grid *ngIf="recents.length > 0">-->
      <!--  <ion-row>-->
      <!--    <ion-col col-12 col-sm-6 col-md-6 col-lg-4 col-xl-4 *ngFor="let recipient of recents">-->
      <!--      {{ -->
      <!--    </ion-col>-->
      <!--  </ion-row>-->
      <!--</ion-grid>-->
      
  </ion-list>
</ion-content>

<ion-footer padding>
  <button ion-button icon-left block (click)="send()" [disabled]="!recipientId">
    <ion-icon name="send"></ion-icon>
    Send
  </button>
</ion-footer>
