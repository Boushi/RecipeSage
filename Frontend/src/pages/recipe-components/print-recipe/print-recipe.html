<link href="https://fonts.googleapis.com/css?family=Noto+Serif|Noto+Sans" rel="stylesheet" />

<ion-item>
  <ion-thumbnail *ngIf="recipe.image" item-start>
    <img src="{{ recipe.image.location }}">
  </ion-thumbnail>

  <h2 class="recipeTitle sans" text-wrap>{{ recipe.title }}</h2>

  <ion-grid class="meta sans" *ngIf="recipe.source || recipe.url || recipe.activeTime || recipe.totalTime || recipe.yield">
    <ion-row>
      <ion-col *ngIf="recipe.source || recipe.url" col-auto>
        <p text-wrap>
          <b>Source:</b>
          <a *ngIf='recipe.url.trim()' href="{{ recipe.url ? recipe.url : '' }}" target="_blank">{{ recipe.source.trim() || recipe.url }}</a>
          <span *ngIf='!recipe.url.trim()'>{{ recipe.source }}</span>
        </p>
      </ion-col>
      <ion-col *ngIf="recipe.activeTime" col-auto>
        <p text-wrap><b>Active Time: </b>{{ recipe.activeTime }}</p>
      </ion-col>
      <ion-col *ngIf="recipe.totalTime" col-auto>
        <p text-wrap><b>Total Time: </b>{{ recipe.totalTime }}</p>
      </ion-col>
      <ion-col *ngIf="recipe.yield" col-auto>
        <p text-wrap><b>Yield: </b>{{ recipe.yield }}</p>
      </ion-col>
    </ion-row>
  </ion-grid>
  <p text-wrap>{{ recipe.description }}</p>
</ion-item>

<ion-item *ngIf="recipe.folder === 'inbox' && recipe.fromUser">
  <p text-wrap>
    <b>This recipe was sent to you by {{ recipe.fromUser.name || recipe.fromUser.email }}</b><br />
    Add this recipe to your recipes by clicking the button at the bottom of the page.<br /><br />
  </p>
</ion-item>

<br *ngIf="!(recipe.yield || recipe.activeTime || recipe.totalTime || recipe.source || recipe.url)" />

<ion-grid class="ingredientsInstructionsGrid">
  <ion-row align-items-start>
    <ion-col class="ingredientsCol" col-12>
      <ion-item>
        <ion-icon name="book" item-start large></ion-icon>
        <p>Ingredients</p>
      </ion-item>
      <ion-item class="ingredients" text-wrap>
        <p *ngFor="let ingredient of ingredients"
          [innerHTML]="ingredient.content"
          class="ingredient"
          [ngClass]="{ ingredientContent: !ingredient.isHeader, complete: ingredient.complete }"
          (click)="ingredientClicked($event, ingredient)"></p>
        <p *ngIf="!ingredients || ingredients.length === 0">No Ingredients</p>
        <p>
          <a class="scale" (click)="changeScale()">{{ scale }}x scale (click to change)</a>
        </p>
      </ion-item>
    </ion-col>
    <ion-col class="instructionsCol" col-12 col-sm-auto>
      <ion-item>
        <ion-icon name="list" item-start large></ion-icon>
        <p>Instructions</p>
      </ion-item>
      <ion-item class="instructions" text-wrap>
        <p *ngFor="let instruction of instructions" class="instruction" text-wrap>
          <span *ngIf="instruction.isHeader"><b class="sectionHeader">{{instruction.content}}</b></span>
          <span
            *ngIf="!instruction.isHeader"
            (click)="instructionClicked($event, instruction)"
            [ngClass]="{ complete: instruction.complete }">
            <b>{{instruction.count}} &nbsp;</b> <span class="instructionContent" [innerHTML]="instruction.content"></span>
          </span>
        </p>
        <p *ngIf="!instructions || instructions.length === 0">No Instructions</p>
      </ion-item>
    </ion-col>
  </ion-row>
</ion-grid>

<div *ngIf="recipe.notes">
  <ion-item>
    <ion-icon name="paper" item-start large></ion-icon>
    <p>Notes</p>
  </ion-item>
  <ion-item text-wrap>
    <p class="pre">{{ recipe.notes || 'No Notes' }}</p>
  </ion-item>
  <br />
</div>

<ion-item *ngIf="recipe.folder !== 'inbox'" class="labels" no-margin text-wrap>
  <ion-icon name="pricetag" item-start large></ion-icon>
  <p>Labels</p>
</ion-item>

<ion-item *ngIf="recipe.id && !recipe.isOwner">
  <p>
    You can add labels once you save this recipe to your collection
  </p>
</ion-item>

<div class='dropdownSelect' *ngIf="recipe.folder !== 'inbox' && recipe.isOwner">

  <div class="labels">
    <span class="label" *ngFor="let label of selectedLabels">
      <ion-icon class="delete-label" (click)="deleteLabel(labelObjectsByTitle[label])" name="trash" item-start></ion-icon>
      {{ label }}
    </span>
  </div>

  <input
    [(ngModel)]='pendingLabel'
    (focus)='toggleAutocomplete(true)'
    (focusout)='toggleAutocomplete(false, $event)'
    (blur)='toggleAutocomplete(false, $event)'
    (keyup.enter)="addLabel($event.target.value); $event.target.value = ''"
    placeholder="Create or select label"
    autocomplete="off"
    #labelInputField
    id="labelInputField" />
  <div class="autocomplete" (focusout)='toggleAutocomplete(false, $event)' *ngIf="showAutocomplete">
    <button
      class="suggestion"
      *ngIf="pendingLabel && pendingLabel.length > 0 && selectedLabels.indexOf(pendingLabel) === -1"
      (click)="addLabel(pendingLabel)">
      <ion-item>
        {{ pendingLabel }}
        <span class="hint">Click to create</span>
      </ion-item>
    </button>
    <button
      class="suggestion"
      *ngIf="pendingLabel && pendingLabel.length > 0 && selectedLabels.indexOf(pendingLabel) > -1">
      <ion-item>
        {{ pendingLabel }}
        <span class="hint">Already added</span>
      </ion-item>
    </button>
    <button
      class="suggestion"
      *ngFor="let label of existingLabels | labelAutocompleteFilter:pendingLabel+selectedLabels.join():pendingLabel:selectedLabels"
      (click)="addLabel(label)">
      <ion-item>
        {{ label }}
        <span class="hint">Click to add</span>
      </ion-item>
    </button>
  </div>
</div>

<br />

<ion-item>
  <p>
    Created {{ prettyDateTime(recipe.createdAt) }}<br />
    Last edited {{ prettyDateTime(recipe.updatedAt) }}
  </p>
</ion-item>
